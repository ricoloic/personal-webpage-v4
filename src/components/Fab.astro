---
import FabButton from "./FabButton.astro";
import MenuIcon from "./icons/MenuIcon.astro";
import ShareIcon from "./icons/ShareIcon.astro";
---

<div
    id="fab-container"
    class="absolute bottom-5 right-5 pl-5 flex flex-col-reverse items-end gap-1">
    <div
        class="flex flex-wrap max-w-fit items-center justify-evenly rounded-full bg-zinc-800 p-2 gap-2">
        <FabButton name="share-button">
            <ShareIcon />
        </FabButton>
        <slot />
    </div>
</div>

<div
    id="link-copied-alert"
    class="bg-transparent flex flex-col items-center justify-center fixed w-full z-50 p-3 hidden">
    <div
        class="mx-auto leading-none h-min rounded-2xl flex items-center text-white bg-zinc-800 p-2"
        role="alert">
        <span class="font-semibold mx-2 text-left flex-auto">
            URL copied to clipboard!
        </span>
        <button type="button" name="link-copied-alert-close-button">
            <span class="sr-only">Close Button</span>
            <i class="fa-regular fa-circle-xmark fa-lg"></i>
        </button>
    </div>
</div>

<script is:inline src="/js/utils/html.js"></script>

<script lang="js">
window.addEventListener("load", function () {
    const eContainer = document.getElementById("fab-container");

    const eDropdowns = document.querySelectorAll(
        'div[data-group="fab-dropdown"]'
    );

    for (const elem of eDropdowns) {
        eContainer.appendChild(elem);
    }

    const eLinkAlert = document.getElementById("link-copied-alert");

    function handleClickCloseLinkAlertButton() {
        addClass(eLinkAlert, "hidden");
    }

    function copyUrl() {
        navigator.clipboard
            .writeText(window.location.href)
            .then(function () {
                removeClass(eLinkAlert, "hidden");
                setTimeout(handleClickCloseLinkAlertButton, 3000);
            });
    }

    function handleClickShare() {
        const data = window.location;
        if (navigator.share) navigator.share(data).catch(() => copyUrl());
        else copyUrl();
    }

    document
        .querySelector('button[name="share-button"]')
        .addEventListener("click", handleClickShare);

    document
        .querySelector('button[name="link-copied-alert-close-button"]')
        .addEventListener("click", handleClickCloseLinkAlertButton);
});
</script>
